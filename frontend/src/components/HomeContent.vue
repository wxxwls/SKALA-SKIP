<template>
  <div
    class="w-full h-full flex"
    :style="{
      background: 'var(--background-secondary)',
      paddingLeft: '64px'
    }"
  >
    <!-- Main Content Area -->
    <div class="flex-1 overflow-y-auto" :style="{ padding: 'var(--spacing-2xl) var(--spacing-2xl) var(--spacing-2xl) var(--spacing-3xl)' }">
      <!-- Top - RE100 ë‹¬ì„±í˜„í™© (3 boxes) -->
      <div :style="{ marginBottom: 'var(--spacing-2xl)' }">
        <h2 :style="{ fontSize: '24px', fontWeight: 'var(--font-weight-semibold)', color: 'var(--foreground)', marginBottom: 'var(--spacing-xl)' }">
          êµ­ë‚´ì™¸ RE100 ë‹¬ì„±í˜„í™©
        </h2>
        <div class="grid grid-cols-3 gap-6">
          <div
:style="{
            background: 'var(--card)',
            borderRadius: 'var(--radius-xl)',
            padding: 'var(--spacing-2xl)',
            border: '1px solid var(--border)',
            boxShadow: 'var(--shadow-sm)',
            transition: 'all 0.2s'
          }"
          class="hover:shadow-md"
>
            <div :style="{ fontSize: '13px', color: 'var(--foreground-secondary)', marginBottom: 'var(--spacing-md)', fontWeight: 'var(--font-weight-medium)' }">
              êµ­ë‚´ RE100 ë‹¬ì„±ë¥ 
            </div>
            <div :style="{ fontSize: '40px', fontWeight: 'var(--font-weight-bold)', marginBottom: 'var(--spacing-md)', color: 'var(--primary)' }">
              68%
            </div>
            <div class="flex items-center gap-1" :style="{ fontSize: '13px', color: 'var(--color-success)', fontWeight: 'var(--font-weight-medium)' }">
              <TrendingUp :size="16" />
              <span>+12% ì „ë…„ ëŒ€ë¹„</span>
            </div>
          </div>

          <div
:style="{
            background: 'var(--card)',
            borderRadius: 'var(--radius-xl)',
            padding: 'var(--spacing-2xl)',
            border: '1px solid var(--border)',
            boxShadow: 'var(--shadow-sm)',
            transition: 'all 0.2s'
          }"
          class="hover:shadow-md"
>
            <div :style="{ fontSize: '13px', color: 'var(--foreground-secondary)', marginBottom: 'var(--spacing-md)', fontWeight: 'var(--font-weight-medium)' }">
              ê¸€ë¡œë²Œ RE100 í‰ê· 
            </div>
            <div :style="{ fontSize: '40px', fontWeight: 'var(--font-weight-bold)', marginBottom: 'var(--spacing-md)', color: 'var(--color-info)' }">
              82%
            </div>
            <div class="flex items-center gap-1" :style="{ fontSize: '13px', color: 'var(--color-success)', fontWeight: 'var(--font-weight-medium)' }">
              <TrendingUp :size="16" />
              <span>+8% ì „ë…„ ëŒ€ë¹„</span>
            </div>
          </div>

          <div
:style="{
            background: 'var(--card)',
            borderRadius: 'var(--radius-xl)',
            padding: 'var(--spacing-2xl)',
            border: '1px solid var(--border)',
            boxShadow: 'var(--shadow-sm)',
            transition: 'all 0.2s'
          }"
          class="hover:shadow-md"
>
            <div :style="{ fontSize: '13px', color: 'var(--foreground-secondary)', marginBottom: 'var(--spacing-md)', fontWeight: 'var(--font-weight-medium)' }">
              SK ê·¸ë£¹ ë‹¬ì„±ë¥ 
            </div>
            <div :style="{ fontSize: '40px', fontWeight: 'var(--font-weight-bold)', marginBottom: 'var(--spacing-md)', color: 'var(--color-success)' }">
              76%
            </div>
            <div class="flex items-center gap-1" :style="{ fontSize: '13px', color: 'var(--color-success)', fontWeight: 'var(--font-weight-medium)' }">
              <TrendingUp :size="16" />
              <span>+15% ì „ë…„ ëŒ€ë¹„</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Middle - íƒ„ì†Œë°°ì¶œëŸ‰ & íƒ„ì†Œë°°ì¶œê¶Œ ê·¸ë˜í”„ -->
      <div class="grid grid-cols-2 gap-6" :style="{ marginBottom: '24px' }">
        <!-- íƒ„ì†Œë°°ì¶œëŸ‰ -->
        <div
:style="{
          background: '#FFFFFF',
          borderRadius: '12px',
          padding: '24px',
          border: '1px solid #E8EAED'
        }">
          <div :style="{ marginBottom: '20px' }">
            <div :style="{ fontSize: '12px', color: '#6B7280', marginBottom: '4px' }">
              Carbon Emissions
            </div>
            <div :style="{ fontSize: '16px', fontWeight: 600, color: '#1A1F2E' }">
              íƒ„ì†Œë°°ì¶œëŸ‰ ì¶”ì´
            </div>
            <div :style="{ fontSize: '28px', fontWeight: 700, color: '#1A1F2E', marginTop: '8px' }">
              350t <span :style="{ fontSize: '14px', color: '#10B981', fontWeight: 600 }">â–¼ 5.4%</span>
            </div>
          </div>
          <!-- Simple Chart -->
          <div :style="{ height: '200px', display: 'flex', alignItems: 'flex-end', gap: '8px', paddingTop: '20px' }">
            <div v-for="(item, index) in emissionData" :key="index" :style="{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '8px' }">
              <div :style="{ width: '100%', background: 'linear-gradient(to top, #FF6B9D20, #FF6B9D)', borderRadius: '4px', height: `${item.value / 5}px` }"></div>
              <span :style="{ fontSize: '11px', color: '#9CA3AF' }">{{ item.month }}</span>
            </div>
          </div>
        </div>

        <!-- íƒ„ì†Œë°°ì¶œê¶Œ -->
        <div
:style="{
          background: '#FFFFFF',
          borderRadius: '12px',
          padding: '24px',
          border: '1px solid #E8EAED'
        }">
          <div :style="{ marginBottom: '20px' }">
            <div :style="{ fontSize: '12px', color: '#6B7280', marginBottom: '4px' }">
              Carbon Credits
            </div>
            <div :style="{ fontSize: '16px', fontWeight: 600, color: '#1A1F2E' }">
              íƒ„ì†Œë°°ì¶œê¶Œ ê±°ë˜ëŸ‰
            </div>
            <div :style="{ fontSize: '28px', fontWeight: 700, color: '#1A1F2E', marginTop: '8px' }">
              190K <span :style="{ fontSize: '14px', color: '#10B981', fontWeight: 600 }">â–² 8.2%</span>
            </div>
          </div>
          <!-- Simple Chart -->
          <div :style="{ height: '200px', display: 'flex', alignItems: 'flex-end', gap: '8px', paddingTop: '20px' }">
            <div v-for="(item, index) in creditData" :key="index" :style="{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '8px' }">
              <div :style="{ width: '100%', background: 'linear-gradient(to top, #10B98120, #10B981)', borderRadius: '4px', height: `${item.value}px` }"></div>
              <span :style="{ fontSize: '11px', color: '#9CA3AF' }">{{ item.month }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom - í‚¤ì›Œë“œ íŠ¸ë Œë“œ ë¶„ì„ (ì „ì²´ ë„ˆë¹„) -->
      <div
        :style="{
          background: '#FFFFFF',
          borderRadius: '12px',
          padding: '24px',
          border: '1px solid #E8EAED',
          marginBottom: '24px'
        }"
      >
        <div class="flex items-center justify-between" :style="{ marginBottom: '20px' }">
          <div class="flex items-center gap-3">
            <div :style="{ fontSize: '18px', fontWeight: 600, color: '#1A1F2E' }">
              í‚¤ì›Œë“œ íŠ¸ë Œë“œ ë¶„ì„
            </div>
            <div
              v-if="totalNewsCount > 0"
              :style="{
                padding: '4px 10px',
                borderRadius: '12px',
                background: '#FF8F6815',
                fontSize: '12px',
                color: '#FF8F68',
                fontWeight: 500
              }"
            >
              {{ totalNewsCount }}ê±´ ë¶„ì„
            </div>
          </div>
          <button
            class="flex items-center gap-1 transition-all hover:bg-gray-100"
            :style="{
              padding: '8px 16px',
              borderRadius: '8px',
              border: '1px solid #E8EAED',
              background: '#FFFFFF',
              fontSize: '13px',
              color: '#6B7280',
              cursor: 'pointer'
            }"
            :disabled="isLoadingKeywords"
            @click="refreshKeywordData"
          >
            <RefreshCw :size="16" :class="{ 'animate-spin': isLoadingKeywords }" />
            <span>{{ isLoadingKeywords ? 'ë¶„ì„ ì¤‘...' : 'ìƒˆë¡œê³ ì¹¨' }}</span>
          </button>
        </div>

        <!-- ê´€ê³„ë„ & ì—°ê´€ì–´ ë¶„ì„ ê°€ë¡œ ë°°ì¹˜ -->
        <div class="grid grid-cols-2 gap-6">
          <!-- ê´€ê³„ë„ ë¶„ì„ -->
          <div
            :style="{
              background: '#F7F8FA',
              borderRadius: '12px',
              padding: '16px',
              height: '380px'
            }"
          >
            <div class="flex items-center gap-2 mb-3" :style="{ fontSize: '14px', fontWeight: 600, color: '#1A1F2E' }">
              <span>ğŸ”—</span>
              <span>ê´€ê³„ë„ ë¶„ì„</span>
            </div>
            <KeywordGraph :keywords="keywordGraphData" height="330px" />
          </div>

          <!-- ì—°ê´€ì–´ ë¶„ì„ -->
          <div
            :style="{
              background: '#F7F8FA',
              borderRadius: '12px',
              padding: '16px',
              height: '380px'
            }"
          >
            <div class="flex items-center gap-2 mb-3" :style="{ fontSize: '14px', fontWeight: 600, color: '#1A1F2E' }">
              <span>ğŸ“Š</span>
              <span>ì—°ê´€ì–´ ë¶„ì„</span>
            </div>
            <WordCloud :words="wordCloudData" height="330px" />
          </div>
        </div>
      </div>

      <!-- ì˜¤ëŠ˜ì˜ ESG ë‰´ìŠ¤ -->
      <div
        :style="{
          background: '#FFFFFF',
          borderRadius: '12px',
          padding: '24px',
          border: '1px solid #E8EAED'
        }"
      >
        <div class="flex items-center gap-2 mb-4">
          <Newspaper class="w-5 h-5" :style="{ color: '#FF8F68' }" />
          <div :style="{ fontSize: '16px', fontWeight: 600, color: '#1A1F2E' }">
            ì˜¤ëŠ˜ì˜ ESG ë‰´ìŠ¤
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div
            v-for="item in news"
            :key="item.id"
            class="p-3 rounded-lg transition-all hover:bg-gray-50 cursor-pointer"
            :style="{ border: '1px solid #F3F4F6' }"
          >
            <div class="flex items-start gap-2 mb-2">
              <div
                :style="{
                  padding: '2px 8px',
                  borderRadius: '4px',
                  fontSize: '10px',
                  fontWeight: 600,
                  color: '#FFFFFF',
                  background: getCategoryColor(item.category),
                  flexShrink: 0
                }"
              >
                {{ getCategoryLabel(item.category) }}
              </div>
              <div :style="{ fontSize: '10px', color: '#9CA3AF' }">
                {{ item.time }}
              </div>
            </div>
            <div :style="{ fontSize: '13px', fontWeight: 500, color: '#1A1F2E', marginBottom: '4px', lineHeight: '1.5' }">
              {{ item.title }}
            </div>
            <div :style="{ fontSize: '11px', color: '#6B7280' }">
              {{ item.source }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Sidebar - ì—…ë¬´ì¼ì • -->
    <div
:style="{
      width: '340px',
      background: '#FFFFFF',
      borderLeft: '1px solid #E8EAED',
      display: 'flex',
      flexDirection: 'column',
      flexShrink: 0,
      height: '100%'
    }">
      <!-- Header -->
      <div
:style="{
        padding: '24px 20px 16px',
        borderBottom: '1px solid #E8EAED'
      }">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <Calendar class="w-5 h-5" :style="{ color: '#FF8F68' }" />
            <div :style="{ fontSize: '16px', fontWeight: 600, color: '#1A1F2E' }">
              ì—…ë¬´ì¼ì •
            </div>
          </div>
          <button
            class="flex items-center justify-center transition-all hover:bg-gray-100"
            :style="{
              width: '32px',
              height: '32px',
              borderRadius: '8px',
              background: '#F7F8FA',
              border: 'none',
              cursor: 'pointer'
            }"
            @click="showAddSchedule = true"
          >
            <Plus :size="18" :style="{ color: '#FF8F68' }" :stroke-width="2.5" />
          </button>
        </div>

        <!-- View Selector -->
        <div class="flex gap-2">
          <button
            v-for="view in ['yearly', 'monthly', 'weekly']"
            :key="view"
            :style="{
              flex: 1,
              padding: '8px 12px',
              borderRadius: '6px',
              border: 'none',
              fontSize: '12px',
              fontWeight: 600,
              background: scheduleView === view ? 'linear-gradient(120deg, #FF8F68, #F76D47)' : '#F7F8FA',
              color: scheduleView === view ? '#FFFFFF' : '#6B7280',
              cursor: 'pointer',
              transition: 'all 0.2s'
            }"
            @click="scheduleView = view as any"
          >
            {{ view === 'yearly' ? 'ì—°ê°„' : view === 'monthly' ? 'ì›”ê°„' : 'ì£¼ê°„' }}
          </button>
        </div>
      </div>

      <!-- Schedule List -->
      <div class="flex-1 overflow-y-auto" :style="{ padding: '16px 20px' }">
        <!-- Add Schedule Form -->
        <div
          v-if="showAddSchedule"
          :style="{
            padding: '16px',
            background: '#F7F8FA',
            borderRadius: '8px',
            marginBottom: '16px',
            border: '1px solid #E8EAED'
          }"
        >
          <div class="space-y-3">
            <input
              v-model="newSchedule.date"
              type="text"
              placeholder="ë‚ ì§œ (ì˜ˆ: 3ì›” 15ì¼)"
              :style="{
                width: '100%',
                padding: '8px 12px',
                borderRadius: '6px',
                border: '1px solid #E8EAED',
                fontSize: '12px',
                color: '#1A1F2E',
                background: '#FFFFFF'
              }"
            />
            <input
              v-model="newSchedule.time"
              type="text"
              placeholder="ì‹œê°„ (ì˜ˆ: 09:00)"
              :style="{
                width: '100%',
                padding: '8px 12px',
                borderRadius: '6px',
                border: '1px solid #E8EAED',
                fontSize: '12px',
                color: '#1A1F2E',
                background: '#FFFFFF'
              }"
            />
            <input
              v-model="newSchedule.title"
              type="text"
              placeholder="ì œëª©"
              :style="{
                width: '100%',
                padding: '8px 12px',
                borderRadius: '6px',
                border: '1px solid #E8EAED',
                fontSize: '12px',
                color: '#1A1F2E',
                background: '#FFFFFF'
              }"
            />
            <div class="flex gap-2">
              <button
                :style="{
                  flex: 1,
                  padding: '8px 12px',
                  borderRadius: '6px',
                  background: 'linear-gradient(120deg, #FF8F68, #F76D47)',
                  border: 'none',
                  color: '#FFFFFF',
                  fontSize: '12px',
                  fontWeight: 600,
                  cursor: 'pointer',
                  transition: 'all 0.2s'
                }"
                @click="handleAddSchedule"
              >
                ì¶”ê°€
              </button>
              <button
                :style="{
                  flex: 1,
                  padding: '8px 12px',
                  borderRadius: '6px',
                  background: '#F3F4F6',
                  border: 'none',
                  color: '#6B7280',
                  fontSize: '12px',
                  fontWeight: 600,
                  cursor: 'pointer',
                  transition: 'all 0.2s'
                }"
                @click="showAddSchedule = false"
              >
                ì·¨ì†Œ
              </button>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <div
            v-for="schedule in filteredSchedules"
            :key="schedule.id"
            class="transition-all hover:shadow-md"
            :style="{
              background: '#FFFFFF',
              border: '1px solid #E8EAED',
              borderRadius: '10px',
              padding: '14px',
              cursor: 'pointer'
            }"
          >
            <!-- Date & Time -->
            <div class="flex items-center justify-between mb-2">
              <div :style="{ fontSize: '11px', color: '#9CA3AF', fontWeight: 500 }">
                {{ schedule.date }}
              </div>
              <div
:style="{
                fontSize: '11px',
                fontWeight: 600,
                color: getStatusColor(schedule.status),
                padding: '2px 8px',
                borderRadius: '4px',
                background: `${getStatusColor(schedule.status)}15`
              }">
                {{ schedule.time }}
              </div>
            </div>

            <!-- Title -->
            <div
:style="{
              fontSize: '13px',
              fontWeight: 600,
              color: '#1A1F2E',
              marginBottom: '10px',
              lineHeight: '1.4'
            }">
              {{ schedule.title }}
            </div>

            <!-- Task List -->
            <div class="space-y-2">
              <div v-for="task in schedule.tasks" :key="task.id" class="flex items-center gap-2">
                <div
                  :style="{
                    width: '16px',
                    height: '16px',
                    borderRadius: '4px',
                    border: `2px solid ${task.completed ? getStatusColor(schedule.status) : '#E8EAED'}`,
                    background: task.completed ? getStatusColor(schedule.status) : '#FFFFFF',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    flexShrink: 0,
                    transition: 'all 0.2s'
                  }"
                >
                  <svg v-if="task.completed" width="10" height="8" viewBox="0 0 10 8" fill="none">
                    <path d="M1 4L3.5 6.5L9 1" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div
:style="{
                  fontSize: '11px',
                  color: task.completed ? '#9CA3AF' : '#6B7280',
                  textDecoration: task.completed ? 'line-through' : 'none'
                }">
                  {{ task.title }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { Calendar, Newspaper, Plus, TrendingUp, RefreshCw } from 'lucide-vue-next'
import KeywordGraph from './charts/KeywordGraph.vue'
import WordCloud from './charts/WordCloud.vue'
import mediaApi, { EsgIssue } from '../api/media.api'

interface NewsItem {
  id: string
  title: string
  source: string
  time: string
  category: 'esg' | 'carbon' | 're100' | 'regulation'
}

interface TaskItem {
  id: string
  title: string
  completed: boolean
}

interface ScheduleItem {
  id: string
  date: string
  time: string
  title: string
  status: 'done' | 'progress' | 'pending'
  progress: number
  view: 'yearly' | 'monthly' | 'weekly'
  tasks: TaskItem[]
}

const emissionData = [
  { month: 'Jan', value: 420 },
  { month: 'Feb', value: 380 },
  { month: 'Mar', value: 440 },
  { month: 'Apr', value: 390 },
  { month: 'May', value: 370 },
  { month: 'Jun', value: 350 },
]

const creditData = [
  { month: 'Jan', value: 120 },
  { month: 'Feb', value: 145 },
  { month: 'Mar', value: 135 },
  { month: 'Apr', value: 160 },
  { month: 'May', value: 175 },
  { month: 'Jun', value: 190 },
]

const scheduleView = ref<'yearly' | 'monthly' | 'weekly'>('weekly')
const showAddSchedule = ref(false)
const schedules = ref<ScheduleItem[]>([
  {
    id: '1',
    date: '3ì›” 15ì¼',
    time: '09:00',
    title: 'ESG ìœ„ì›íšŒ íšŒì˜',
    status: 'done',
    progress: 100,
    view: 'weekly',
    tasks: [
      { id: '1-1', title: 'íšŒì˜ ìë£Œ ì¤€ë¹„', completed: true },
      { id: '1-2', title: 'ì°¸ì„ì í™•ì¸', completed: true },
      { id: '1-3', title: 'íšŒì˜ë¡ ì‘ì„±', completed: true }
    ]
  },
  {
    id: '2',
    date: '3ì›” 16ì¼',
    time: '14:00',
    title: 'íƒ„ì†Œë°°ì¶œê¶Œ ê±°ë˜ ê²€í† ',
    status: 'progress',
    progress: 65,
    view: 'weekly',
    tasks: [
      { id: '2-1', title: 'ì‹œì¥ ë™í–¥ ë¶„ì„', completed: true },
      { id: '2-2', title: 'ê±°ë˜ ì „ëµ ìˆ˜ë¦½', completed: true },
      { id: '2-3', title: 'ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸°', completed: false }
    ]
  },
  {
    id: '3',
    date: '3ì›” 18ì¼',
    time: '10:00',
    title: 'ì§€ì†ê°€ëŠ¥ê²½ì˜ ë³´ê³ ì„œ ë°œê°„',
    status: 'pending',
    progress: 30,
    view: 'weekly',
    tasks: [
      { id: '3-1', title: 'ë°ì´í„° ìˆ˜ì§‘', completed: true },
      { id: '3-2', title: 'ë³´ê³ ì„œ ì‘ì„±', completed: false },
      { id: '3-3', title: 'ê²€í†  ë° ìŠ¹ì¸', completed: false }
    ]
  },
  {
    id: '6',
    date: '3ì›” 1ì£¼',
    time: 'ì „ì²´',
    title: 'ESG ì „ëµ ìˆ˜ë¦½',
    status: 'done',
    progress: 100,
    view: 'monthly',
    tasks: [
      { id: '6-1', title: 'í˜„í™© ë¶„ì„', completed: true },
      { id: '6-2', title: 'ì „ëµ ìˆ˜ë¦½', completed: true },
      { id: '6-3', title: 'ì‹¤í–‰ ê³„íš ìˆ˜ë¦½', completed: true }
    ]
  },
  {
    id: '10',
    date: '1ë¶„ê¸°',
    time: 'Q1',
    title: 'ESG ê²½ì˜ì²´ê³„ êµ¬ì¶•',
    status: 'done',
    progress: 100,
    view: 'yearly',
    tasks: [
      { id: '10-1', title: 'ì¡°ì§ êµ¬ì„±', completed: true },
      { id: '10-2', title: 'í”„ë¡œì„¸ìŠ¤ ìˆ˜ë¦½', completed: true },
      { id: '10-3', title: 'ì‹œìŠ¤í…œ êµ¬ì¶•', completed: true }
    ]
  },
])

const newSchedule = ref({
  date: '',
  time: '',
  title: ''
})

const news: NewsItem[] = [
  { id: '1', title: 'SK, 2024ë…„ íƒ„ì†Œë°°ì¶œ 30% ê°ì¶• ëª©í‘œ ë‹¬ì„±...ì¹œí™˜ê²½ íˆ¬ì í™•ëŒ€', source: 'í•œêµ­ê²½ì œ', time: '2ì‹œê°„ ì „', category: 'carbon' },
  { id: '2', title: 'EU íƒ„ì†Œêµ­ê²½ì„¸(CBAM) ë³¸ê²© ì‹œí–‰, êµ­ë‚´ ìˆ˜ì¶œê¸°ì—… ëŒ€ì‘ ì‹œê¸‰', source: 'ë§¤ì¼ê²½ì œ', time: '5ì‹œê°„ ì „', category: 'regulation' },
  { id: '3', title: 'ì‚¼ì„±ì „ì, RE100 ì´í–‰ ë¡œë“œë§µ ë°œí‘œ...2030ë…„ê¹Œì§€ ì¬ìƒì—ë„ˆì§€ 100% ì „í™˜', source: 'ì¡°ì„ ì¼ë³´', time: '1ì¼ ì „', category: 're100' },
  { id: '4', title: 'êµ­ë‚´ ESG ê³µì‹œ ì˜ë¬´í™” 2025ë…„ ì ìš© ì˜ˆì •, ëŒ€ê¸°ì—… ì¤€ë¹„ ë°•ì°¨', source: 'ì—°í•©ë‰´ìŠ¤', time: '1ì¼ ì „', category: 'esg' },
  { id: '5', title: 'CDP í•œêµ­ìœ„ì›íšŒ, 2024 ê¸°í›„ë³€í™” ìš°ìˆ˜ê¸°ì—…', source: 'ì„œìš¸ê²½ì œ', time: '2ì¼ ì „', category: 'esg' },
]

// í‚¤ì›Œë“œ ê´€ê³„ë„ ë°ì´í„°
interface KeywordNode {
  name: string
  value: number
  category: string
}

const keywordGraphData = ref<KeywordNode[]>([
  { name: 'SKí•˜ì´ë‹‰ìŠ¤', value: 45, category: 'central' },
  { name: 'í˜„ëŒ€ì—”ì§€ë‹ˆì–´ë§', value: 35, category: 'E' },
  { name: 'ì‚¼ì„±ì „ì', value: 32, category: 'E' },
  { name: 'M15X', value: 28, category: 'G' },
  { name: 'ë¯¸êµ­', value: 25, category: 'S' },
  { name: 'SKí…”ë ˆì½¤', value: 24, category: 'G' },
  { name: 'AWS', value: 22, category: 'E' },
  { name: 'í•˜ì´ë¸Œë¦¬ë“œ', value: 20, category: 'E' },
  { name: 'ì—”ë¹„ë””ì•„', value: 18, category: 'G' },
  { name: 'ê²½ê¸°ë„', value: 16, category: 'S' },
  { name: 'ëŒ€í†µë ¹', value: 15, category: 'S' },
  { name: 'ê¸°ì•„', value: 14, category: 'E' },
  { name: 'íŒ¨ë¦¬ë‹¤ì„', value: 12, category: 'G' },
  { name: 'ê²€ìƒ‰ì–´', value: 11, category: 'S' },
  { name: 'ì •ì˜ì„ ', value: 10, category: 'G' },
])

// ì—°ê´€ì–´ ë¶„ì„ ì›Œë“œí´ë¼ìš°ë“œ ë°ì´í„°
const wordCloudData = ref<{ name: string; value: number; category?: string }[]>([
  { name: 'SKí•˜ì´ë‹‰ìŠ¤', value: 45, category: 'E' },
  { name: 'í˜„ëŒ€ìë™ì°¨ê·¸ë£¹', value: 38, category: 'E' },
  { name: 'íŒ¨ëŸ¬ë‹¤ì„', value: 32, category: 'G' },
  { name: 'ë¯¸êµ­', value: 30, category: 'S' },
  { name: 'SKê·¸ë£¹', value: 28, category: 'G' },
  { name: 'í˜„ëŒ€ì—”ì§€ë‹ˆì–´ë§', value: 26, category: 'E' },
  { name: 'AWS', value: 24, category: 'E' },
  { name: 'ìµœíƒœì›', value: 22, category: 'G' },
  { name: 'í˜„ëŒ€ì œì² ', value: 20, category: 'E' },
  { name: 'ëŒ€í•œë¯¼êµ­', value: 19, category: 'S' },
  { name: 'ì„œìš¸ì‹œ', value: 18, category: 'S' },
  { name: 'ê²½ê¸°ë„', value: 17, category: 'S' },
  { name: 'ê¸°ì•„', value: 16, category: 'E' },
  { name: 'ì„œì‚°', value: 15, category: 'S' },
  { name: 'M15X', value: 14, category: 'G' },
  { name: 'ëŒ€í†µë ¹', value: 13, category: 'S' },
  { name: 'ì •ì˜ì„ ', value: 12, category: 'G' },
  { name: 'ì´ì¬ëª…', value: 11, category: 'S' },
  { name: 'ë¡œë³´í‹±ìŠ¤', value: 10, category: 'E' },
  { name: 'ëŒ€ê²½ê¶Œ', value: 9, category: 'S' },
  { name: 'SKí…”ë ˆì½¤', value: 8, category: 'G' },
  { name: '100ë©”ê°€ì™€íŠ¸', value: 7, category: 'E' },
  { name: 'í•œë°˜ë„', value: 6, category: 'S' },
  { name: 'ì—”ë¹„ë””ì•„', value: 5, category: 'G' },
  { name: 'ì• í”Œ', value: 4, category: 'G' },
  { name: 'ì‚¼ì„±ë™', value: 3, category: 'S' },
  { name: 'ì¡°ì§€ì•„', value: 2, category: 'S' },
  { name: 'ìš©ì¸ë°˜ë„ì²´í´ëŸ¬ìŠ¤í„°', value: 1, category: 'E' },
])

const isLoadingKeywords = ref(false)
const totalNewsCount = ref(0)

// ë‰´ìŠ¤ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ í‚¤ì›Œë“œ ê°±ì‹ 
const refreshKeywordData = async () => {
  isLoadingKeywords.value = true
  try {
    const response = await mediaApi.analyzeNews({
      keywords: ['SKí•˜ì´ë‹‰ìŠ¤', 'ESG', 'íƒ„ì†Œì¤‘ë¦½', 'RE100', 'ì¹œí™˜ê²½', 'ì‚¼ì„±ì „ì', 'í˜„ëŒ€ìë™ì°¨', 'ì§€ì†ê°€ëŠ¥'],
      maxPages: 5
    })

    // ì´ ë‰´ìŠ¤ ìˆ˜ ì—…ë°ì´íŠ¸
    totalNewsCount.value = response.totalArticles || 0

    if (response.statistics?.issueStatistics && response.statistics.issueStatistics.length > 0) {
      // issueStatisticsë¥¼ í‚¤ì›Œë“œ ê·¸ë˜í”„ ë°ì´í„°ë¡œ ë³€í™˜ - ë” ë§ì€ í‚¤ì›Œë“œ í‘œì‹œ
      const newKeywords = response.statistics.issueStatistics.map((stat, index) => ({
        name: stat.issue,
        value: Math.max(stat.count * 5, 10),
        category: stat.esgCategory || (index === 0 ? 'central' : ['E', 'S', 'G'][index % 3])
      }))

      if (newKeywords.length > 0) {
        // í‚¤ì›Œë“œ ê·¸ë˜í”„ì— ë” ë§ì€ ë…¸ë“œ í‘œì‹œ (ìµœëŒ€ 25ê°œ)
        keywordGraphData.value = newKeywords.slice(0, 25)

        // ì›Œë“œí´ë¼ìš°ë“œ ë°ì´í„°ë„ ì—…ë°ì´íŠ¸ (ìµœëŒ€ 40ê°œ)
        wordCloudData.value = newKeywords.slice(0, 40).map(kw => ({
          name: kw.name,
          value: kw.value,
          category: kw.category
        }))
      }

      // ì¹´í…Œê³ ë¦¬ í†µê³„ë„ ì›Œë“œí´ë¼ìš°ë“œì— ì¶”ê°€
      if (response.statistics?.categoryStatistics) {
        const categoryKeywords = Object.entries(response.statistics.categoryStatistics).map(([name, count]) => ({
          name: name === 'E' ? 'í™˜ê²½(E)' : name === 'S' ? 'ì‚¬íšŒ(S)' : 'ì§€ë°°êµ¬ì¡°(G)',
          value: (count as number) * 3,
          category: name === 'E' ? 'E' : name === 'S' ? 'S' : 'G'
        }))
        wordCloudData.value = [...wordCloudData.value, ...categoryKeywords]
      }

      // ê°ì„± í†µê³„ë„ ì¶”ê°€
      if (response.statistics?.sentimentStatistics) {
        const sentimentKeywords = Object.entries(response.statistics.sentimentStatistics).map(([name, count]) => ({
          name: name === 'positive' ? 'ê¸ì •' : name === 'negative' ? 'ë¶€ì •' : 'ì¤‘ë¦½',
          value: (count as number) * 2,
          category: name === 'positive' ? 'E' : name === 'negative' ? 'S' : 'G'
        }))
        wordCloudData.value = [...wordCloudData.value, ...sentimentKeywords]
      }
    } else {
      // API ì‘ë‹µì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ESG ì´ìŠˆ ì •ì˜ ë°ì´í„° ë¡œë“œ
      await loadEsgIssuesData()
    }
  } catch (error) {
    console.error('í‚¤ì›Œë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨, ESG ì´ìŠˆ ë°ì´í„°ë¡œ ëŒ€ì²´:', error)
    // API ì‹¤íŒ¨ì‹œ ESG ì´ìŠˆ ì •ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©
    await loadEsgIssuesData()
  } finally {
    isLoadingKeywords.value = false
  }
}

// ESG ì´ìŠˆ ì •ì˜ ë°ì´í„°ë¡œ ê´€ê³„ë„ ìƒì„±
const loadEsgIssuesData = async () => {
  try {
    const response = await mediaApi.getEsgIssues()
    if (response?.data?.issues) {
      const issues: EsgIssue[] = response.data.issues

      // ì´ìŠˆë¥¼ ê·¸ë˜í”„ ë°ì´í„°ë¡œ ë³€í™˜ (ì¤‘ì•™ ë…¸ë“œ + ESG ì´ìŠˆë“¤)
      const graphKeywords: KeywordNode[] = [
        { name: 'ESG', value: 50, category: 'central' }
      ]

      issues.forEach((issue, index) => {
        graphKeywords.push({
          name: issue.name,
          value: 35 - index * 1.5,
          category: issue.category
        })
      })

      keywordGraphData.value = graphKeywords.slice(0, 15)

      // ì›Œë“œí´ë¼ìš°ë“œëŠ” ESG ì´ìŠˆ í‚¤ì›Œë“œë“¤ë¡œ ìƒì„±
      const cloudWords: { name: string; value: number; category?: string }[] = []
      issues.forEach((issue) => {
        issue.keywords.forEach((keyword, idx) => {
          cloudWords.push({
            name: keyword,
            value: 30 - idx * 5,
            category: issue.category
          })
        })
      })

      wordCloudData.value = cloudWords.slice(0, 30)
    }
  } catch (esgError) {
    console.error('ESG ì´ìŠˆ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', esgError)
  }
}

onMounted(() => {
  // í˜ì´ì§€ ë¡œë“œ ì‹œ í‚¤ì›Œë“œ ë°ì´í„° ê°±ì‹ 
  refreshKeywordData()
})

const filteredSchedules = computed(() => schedules.value.filter(s => s.view === scheduleView.value))

const handleAddSchedule = () => {
  if (!newSchedule.value.date || !newSchedule.value.time || !newSchedule.value.title) return

  const schedule: ScheduleItem = {
    id: Date.now().toString(),
    date: newSchedule.value.date,
    time: newSchedule.value.time,
    title: newSchedule.value.title,
    status: 'pending',
    progress: 0,
    view: scheduleView.value,
    tasks: []
  }

  schedules.value.push(schedule)
  newSchedule.value = { date: '', time: '', title: '' }
  showAddSchedule.value = false
}

const getCategoryColor = (category: string) => {
  switch (category) {
    case 'esg': return '#597EFF'
    case 'carbon': return '#10B981'
    case 're100': return '#F59E0B'
    case 'regulation': return '#EF4444'
    default: return '#6B7280'
  }
}

const getCategoryLabel = (category: string) => {
  switch (category) {
    case 'esg': return 'ESG'
    case 'carbon': return 'íƒ„ì†Œ'
    case 're100': return 'RE100'
    case 'regulation': return 'ê·œì œ'
    default: return ''
  }
}

const getStatusColor = (status: string) => {
  switch (status) {
    case 'done': return '#10B981'
    case 'progress': return '#F59E0B'
    case 'pending': return '#6B7280'
    default: return '#6B7280'
  }
}
</script>
